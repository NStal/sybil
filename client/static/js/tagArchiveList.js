// Generated by CoffeeScript 1.8.0
(function() {
  var TagArchiveList,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  TagArchiveList = (function(_super) {
    __extends(TagArchiveList, _super);

    function TagArchiveList() {
      TagArchiveList.__super__.constructor.call(this, App.templates["tag-archive-list"]);
    }

    TagArchiveList.prototype.setTag = function(tag) {
      var item, _i, _len, _ref;
      this.node.scrollTop = 0;
      this.noMore = false;
      this.currentTag = tag;
      this.UI.emptyHint$.show();
      this.UI.currentArchiveTitle$.text(tag.name);
      _ref = this.archiveListItems;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        item.remove();
      }
      this.archiveListItems.length = 0;
      return this.moreArchive();
    };

    TagArchiveList.prototype.moreArchive = function() {
      var last;
      console.log("....more");
      if (this.noMore) {
        return;
      }
      if (this.isLoadingMore) {
        return;
      }
      if (!this.currentTag) {
        return;
      }
      this.isLoadingMore = true;
      last = this.archiveListItems[this.archiveListItems.length - 1];
      if (last) {
        this.offset = last.archive.guid;
      } else {
        this.offset = null;
      }
      return Archive.getByTag({
        name: this.currentTag.name,
        viewRead: this.viewRead,
        sort: this.sort,
        offset: this.offset,
        count: this.count
      }, (function(_this) {
        return function(err, archives) {
          var archive, archiveListItem, _i, _len, _results;
          console.log("here");
          _this.isLoadingMore = false;
          if (err || !(archives instanceof Array)) {
            console.error(err, archives, _this.currentTag.name);
            console.error(err || "no archive!");
            console.trace();
            return;
          }
          if (archives.length === 0) {
            _this.onNoMore();
            return;
          }
          _results = [];
          for (_i = 0, _len = archives.length; _i < _len; _i++) {
            archive = archives[_i];
            archiveListItem = new ArchiveListItem(archive);
            _results.push(_this.appendQueue.push(archiveListItem));
          }
          return _results;
        };
      })(this));
    };

    return TagArchiveList;

  })(ArchiveList);

  window.TagArchiveList = TagArchiveList;

}).call(this);
